<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>WebRTC P2P Demo (No Server)</title>
  <style>
    video { width: 45%; border: 1px solid #ccc; margin: 5px; }
    textarea { width: 100%; height: 80px; }
    button { margin: 5px; padding: 6px; }
  </style>
</head>
<body>
  <h3>WebRTC P2P Video Call (Copy-Paste Signaling)</h3>
  <video id="localVideo" autoplay muted playsinline></video>
  <video id="remoteVideo" autoplay playsinline></video>

  <div>
    <button onclick="createOffer()">Create Offer</button>
    <button onclick="createAnswer()">Create Answer</button>
    <button onclick="addAnswer()">Add Answer</button>
  </div>

  <textarea id="offer" placeholder="Offer / Answer SDP will appear here"></textarea>

  <script>
    const localVideo = document.getElementById('localVideo');
    const remoteVideo = document.getElementById('remoteVideo');
    const offerBox = document.getElementById('offer');

    const pc = new RTCPeerConnection({
      iceServers: [{ urls: 'stun:stun.l.google.com:19302' }]
    });

    navigator.mediaDevices.getUserMedia({ video: true, audio: true })
      .then(stream => {
        localVideo.srcObject = stream;
        stream.getTracks().forEach(track => pc.addTrack(track, stream));
      });

    pc.ontrack = (event) => {
      remoteVideo.srcObject = event.streams[0];
    };

    pc.onicecandidate = (event) => {
      if (event.candidate) return; // Wait for gathering complete
      offerBox.value = JSON.stringify(pc.localDescription);
    };

    async function createOffer() {
      const offer = await pc.createOffer();
      await pc.setLocalDescription(offer);
    }

    async function createAnswer() {
      const offer = JSON.parse(offerBox.value);
      await pc.setRemoteDescription(offer);
      const answer = await pc.createAnswer();
      await pc.setLocalDescription(answer);
    }

    async function addAnswer() {
      const answer = JSON.parse(offerBox.value);
      await pc.setRemoteDescription(answer);
    }
  </script>
</body>
</html>
